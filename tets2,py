from pywebio.input import *
from pywebio.output import *
import sqlite3
import pandas as pd
import gspread

conn = sqlite3.connect(r'logs.db')
cursor = conn.cursor()
df = pd.read_excel("pusatbantuan_lnsw_fix.xlsx")

try:
    cursor.execute("SELECT * FROM logs")  # Replace 'tablename' with your actual table name

    rows = cursor.fetchall()
    
except sqlite3.Error as e:
    put_text(f"An error occurred while connecting to the database: {e}")
    rows = []  # Ensure rows is an empty list if there's an error
if rows:
    df_logs = pd.DataFrame(rows, columns=[column[0] for column in cursor.description])
else:
    df_logs = pd.DataFrame()
# print(df_logs)

# Get unique phone numbers from the DataFrame
unique_phone_numbers = df_logs['phone_number'].unique()
# Let the user select a phone number
selected_phone_number = select("Pilih nomor: ", options=unique_phone_numbers)
# Filter the DataFrame based on the selected phone number
filtered_logs = df_logs[df_logs['phone_number'] == selected_phone_number]

uniq_answer = df_logs['answer']
print(uniq_answer)
put_text("penjelasan tentang table")




# # Concatenate index and values into a single string
# konten_values = filtered_df['konten'].tolist()
# konten_text = '\n'.join(konten_values)
# for index, value in zip(filtered_df.index, konten_values):
#     konten_text += f"{index}: {value}\n"

# pertannyaan = 'Kalo ssm ekspor itu apa'
# # put_table([
# #     ['Pertanyaan', 'Jawaban', 'Referensi', 'Base Knowledge', 'Penilaian Referensi', 'Penilaian Jawaban'],
# #     ['Kalo ssm ekspor itu apa', jawaban, konten_text, put_buttons(['NO', 'YES'], onclick=...), put_buttons(['NO', 'YES'], onclick=...), put_buttons(['NO', 'YES'], onclick=...)]
# # ])

# table_data = [pertannyaan,jawaban, konten_text]

# def button_click(btn):
#     aa = gspread.service_account(filename="sheet342.json")
#     sheet = aa.open("kritik saran")
#     wr_sheet = sheet.worksheet("isi")
#     row_to_append = [btn]
#     row_to_append.extend(table_data)
#     wr_sheet.append_row(row_to_append)

# display_table_data = [
#     ['Pertannyaan', 'Content', 'Referensi', 'Base Knowledge', 'Penilaian Referensi', 'Penilaian Jawaban'],
#     [table_data[0], table_data[1], table_data[2], put_buttons(['Yes', 'No'], onclick=button_click), put_buttons(['Yes', 'No'], onclick=button_click), put_buttons(['Yes', 'No'], onclick=button_click)]
# ]
# put_table(display_table_data)

# #input saran to gsheet
# aa = gspread.service_account(filename="sheet342.json")
# sheet = aa.open("kritik saran")
# wr_sheet = sheet.worksheet("isi")
# saran = input("Masukkan kritik dan saran Anda:", type="text")
# wr_sheet.append_row([saran])